##编译原理 实验4报告
**实验人**：顾馨兰 202220005  &emsp; 周家琛 202220019
**邮箱**&emsp;： gu_xinlan@163.com
**任务号**：7
**实验时间**：2021年6月

####一、实验内容
**必做要求**：在词法分析、语法分析、语义分析和中间代码生成程序的基础上，将C--源代码翻译为MIPS32指令序列（可以包含伪指令），并在SPIM Simulator上运行。
**选做要求**：无。

####二、运行方式
按照实验指定环境，在`Code/`目录下执行`make parser`.

####三、实验结果
按照实验要求生成了含伪指令的MIPS32指令序列。

####四、实验思路
**1.指令匹配**：
入口为`asm_entry()`，遍历线性中间代码，根据操作类型调用相应的指令生成函数。
一条指令的数据结构如下，以链表形式线性存储。
```c
typedef struct Instr_ *Instr;
struct Instr_
{
    bool islabel;
    char op[6];
    int num_opr; //0-3
    char opr1[15], opr2[15], opr3[15];
};
```
**2.寄存器分配**：
朴素分配寄存器，将所有的局部变量分配在栈中，建立符号表记录相对于栈底$fp的位置，每次使用变量时都从内存中读至寄存器，然后写回内存。
本模块中的符号表结构如下：
```c
struct asm_table
{
    char* name;   //变量名
    int where;    //相对$fp偏移
    struct asm_table *next;
};

struct asm_table *memlist[10000];              //以哈希表形式存储
int append_find_mem(Operand opr, int x);       //查表返回变量位置，没有则插入
```

####五、实验分工
- 顾馨兰：编写汇编指令模块接口，编写实验报告；
- 周家琛：修改实现思路，完成汇编指令模块实现，编写样例调试修改。